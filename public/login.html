<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Log in</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header class="header">
      <div class="header-bar">
        <div>
          <a href="./index.html">
            <img
              src="./images/Group 117.svg"
              alt="–õ–æ–≥–æ—Ç–∏–ø –º–µ–±–ª–µ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω—É"
            />
          </a>
        </div>
        <span class="header-title">–í—Ö—ñ–¥</span>
        <div class="burger-menu">
          <button id="burger-btn">
            <img src="./images/fi-bs-align-justify.svg" alt="–Ü–∫–æ–Ω–∫–∞ –º–µ–Ω—é" />
          </button>
          <nav class="menu" id="menu">
            <ul>
              <li><a href="./about-us.html">–ü—Ä–æ –Ω–∞—Å</a></li>
              <li><a href="./catalog.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
              <li><a href="./contact-us.html">–ö–æ–Ω—Ç–∞–∫—Ç–∏</a></li>
              <li><a href="./blog.html">–ë–ª–æ–≥</a></li>
              <li><a href="./faqs.html">FAQ</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </header>
    <div class="container">
      <div class="form-container">
        <div class="image-container">
          <img src="./images/log_in_furniture.jpg" alt="Image sofa" />
        </div>
        <div class="form-content">
          <h2>–í—Ö—ñ–¥</h2>
          <form id="signup-form">
            <input type="text" id="identifier" placeholder="—ñ–º'—è" required />
            <div class="password-container">
              <input
                type="password"
                id="password"
                placeholder="–ø–∞—Ä–æ–ª—å"
                required
              />
              <span class="toggle-password">
                <img
                  src="images/fi-br-eye.svg"
                  alt="–ü–æ–∫–∞–∑–∞—Ç–∏ –ø–∞—Ä–æ–ª—å"
                  id="togglePassword"
                />
              </span>
            </div>
            <div class="form-options">
              <label class="checkbox-container">
                <input type="checkbox" id="remember-me" />
                <span class="checkmark"></span>
                –ó–∞–ø–∞–º'—è—Ç–∞—Ç–∏ –º–µ–Ω–µ
              </label>
              <a href="#" class="forgot-password">–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </div>
            <button type="submit" class="login">–£–≤—ñ–π—Ç–∏</button>
          </form>
          <p>
            –ù–µ –º–∞—î—Ç–µ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É?
            <a href="./signup.html">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
          </p>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("signup-form");
        form.addEventListener("submit", async e => {
          e.preventDefault();
      
          const identifier = form.querySelector("#identifier").value;
          const password   = form.querySelector("#password").value;
      
          try {
            const response = await fetch("/api/login", {
              method:  "POST",
              headers: { "Content-Type": "application/json" },
              body:    JSON.stringify({ identifier, password })
            });
      
            // –ó—á–∏—Ç—É—î–º–æ JSON —É –±—É–¥—å‚Äë—è–∫–æ–º—É —Ä–∞–∑—ñ
            const data = await response.json();
      
            if (response.ok) {
              // üö© —Ç—É—Ç —Å–∞–º–µ –∑–∞–ø–∞–º‚Äô—è—Ç–æ–≤—É—î–º–æ –≤—Ö—ñ–¥
              localStorage.setItem("isLoggedIn", "true");
              localStorage.setItem("userName", data.user.name);
      
              // –ø–µ—Ä–µ—Ö–æ–¥–∏–º–æ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É
              window.location.href = "index.html";
            } else {
              alert(data.error || "–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ –∞–±–æ –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.");
            }
          } catch (err) {
            console.error(err);
            alert("–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥ —á–∞—Å –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.");
          }
        });
      });
      </script>
  </body>
</html>
